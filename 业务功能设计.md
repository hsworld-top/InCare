

下面是 **需求 + 完整系统设计**

---

# 🧱 一、系统角色（最终四类）

| 角色                      | 描述                            |
| ----------------------- | ----------------------------- |
| **系统管理员（super_admin）** | 创建科室（团队）、修改科室名称、删除科室、查看科室数量与状态、指定团队创建者 |
| **患者（patient）**         | 可自助登记住院信息，查看排队进度、接收提醒、填写检查时间、确认入住等 |
| **医护人员（medical_staff）** | 包含医生与护士全部职能，负责审核患者登记、排队管理、床位、OCR、提醒等 |
| **团队管理员（team_admin）**   | 管理本团队的团队信息、医生、床位、病种、检查、房间、时间、模板等标准化数据和统计数据，由团队创建者分配 |

---

# 🧾 二、核心业务流程

以下所有操作，仅分为 **患者端** 和 **医护端**

---

## ✔ **流程 0：系统管理员创建团队（系统初始化）**

系统管理员端：

1. 创建团队（团队名称、团队代码、团队电话、团队地点、护士长信息等）

2. 指定团队创建者（从已有用户中选择，或创建新用户并设置为团队创建者）

3. 团队创建后，系统自动生成团队邀请二维码（二维码包含：`team_id` + `invite_signature`）

4. 团队创建者可以：
   - 分配团队管理员（将其他用户设置为 `team_admin` 角色）
   - 管理本团队的所有数据（医生、病种、检查、房间等）

5. 团队创建后，该团队下的所有数据（医生、病种、检查、房间等）将独立管理

**说明**：团队和科室是同一个概念，每个团队代表一个独立的科室。系统管理员负责创建和管理所有团队，团队创建者负责管理本团队并分配团队管理员。

---

## ✔ **流程 0.1：医护人员扫码加入团队**

医护人员端：

1. 进入小程序首页，点击"加入团队"

2. 扫描团队邀请二维码（二维码包含：`team_id` + `invite_signature`）

3. 系统识别到 `team_id`，验证 `invite_signature` 有效性

4. 弹出确认信息：
   - 您正在申请加入：[团队名称]
   - 科室地点：[团队地点]
   - 科室电话：[团队电话]
   - 是否确认提交申请？

5. 医护人员确认后，系统创建加入申请记录，状态为"待审核"

6. 医护人员进入"待管理员审核"状态，等待审核结果

团队管理员端：

1. 在"团队医护账号管理"中查看"申请加入列表"

2. 显示申请信息：
   - 申请人姓名（手机号）
   - 申请加入的团队名称
   - 申请时间

3. 管理员可选择：
   - **同意**：系统自动创建医护人员账号，角色设为 `medical_staff`，`team_id` 关联到对应团队，并通知申请人
   - **拒绝**：拒绝申请，并通知申请人

4. 审核通过后，医护人员即可登录使用，登录后只能操作本团队数据

---

## ✔ **流程 1：患者自助登记 + 医护确认提交**

患者端（可选，提前登记）：

1. 填写基本信息（姓名/性别/年龄/电话/诊断描述）

2. 选择团队或病种（从管理员预设列表中选择，不同团队的病种列表独立）

3. 提交登记信息，等待医护审核

4. 可查看登记状态（待审核/已确认/已拒绝）

医护端：

1. 查看患者自助登记列表（待审核状态）

2. 查看患者提交的信息，可进行修改和补充

3. 选择病种（从管理员预设的病种列表中选择）

4. 系统智能推荐负责医生（根据病种匹配医生专长）

5. 医护确认或调整医生选择

6. 设置患者优先级（普通/高优先级/紧急，可选，默认为普通）

7. 确认并提交申请，患者自动进入排队队列（按优先级排序）

8. 通知患者已进入排队

**说明**：患者可提前自助登记，但最终以医护端确认提交为准。医护端也可以直接录入新患者信息，无需等待患者登记。设置优先级后，有空床位时会优先安排高优先级患者。

---

## ✔ **流程 2：医护端管理床位**

虽然登录只分为医护，但“医生”仍作为业务实体存在：

每个医生拥有：

- 总床位

- 已使用床位

- 今日出院患者数 → 释放床位

医护人员可：

- 更新某医生的可用床位

- 查看每个医生的剩余床位

- 当床位释放后，系统自动按优先级顺序通知排队患者（紧急 > 高优先级 > 普通）

医生本身无登录入口（医护人员统一操作即可）。

---

## ✔ **流程 3：医护端拍照住院证 → OCR 自动识别**

医护人员拍照住院证后可自动识别以下信息：

- 姓名

- 性别

- 年龄

- 诊断

- 患者电话

- 科室电话

- 主治医生

- 籍贯

- 入院科室

- 科室地点

识别结果：

- **识别成功**：若已有患者 → 自动匹配并更新信息；若无 → 自动创建患者

- **识别失败**：系统提示识别失败，提供以下降级处理选项：
  1. **重新拍照识别**：允许重新拍摄照片进行识别
  2. **手动录入模式**：切换到手动输入界面，医护人员手动填写所有信息
  3. **部分识别修正**：对识别错误的字段进行手动修正，其他正确字段保留

识别过程支持手动编辑和修改，可在识别完成后进一步调整信息准确性。

---

## ✔ **流程 4：检查提醒流程**

医护人员根据患者病种选择 **预设的检查项目**（从管理员配置的检查类目中勾选，无需手动填写）
医护人员只负责提醒患者去预约检查，不关心检查科室及排班系统（医院内部逻辑）。

患者端：

1. 收到医护提醒

2. 填写自己的检查预约时间

3. 到时间自动提醒 "请前往检查"

后台定时任务扫描 appointment_time。

---

## ✔ **流程 5：住院前一天提醒（系统自动执行）**

系统每天凌晨扫描：

```
计划入院时间 = 明天
```

给医护人员发送提醒：“请处理某患者的入院准备”。

医护人员填写：

- 房间类型（从管理员预设的房间类型中选择）

- 建议来院时间（从管理员配置的时间段中选择）

- 能否按计划住院

- 是否接受房型

- 注意事项（从管理员预设的模板中选择或编辑）

填写后 → 通知患者。

患者端确认：

- 能否按计划住院

- 是否接受房间类型

- 确认来院时间，（8:00 / 14:30）

医护端收到确认后 → 设置为“可入院”状态。

---

## ✔ **流程 6：入院确认 + 床位扣减**

患者确认后：

- 系统检查对应医生床位是否足够

- **床位分配规则**：
  - 有空床位时，按优先级顺序分配（紧急 > 高优先级 > 普通）
  - 同优先级按排队时间先后顺序分配
  - 若足够 → 入院成功 → 床位 -1
  - 若不足 → 提醒医护人员手动处理

- 医护人员可随时调整患者优先级，系统会自动重新排序

---

# 🔧 三、功能清单（按角色）

---

# 🔐 系统管理员端（super_admin）

### **1. 团队（科室）管理**

- **创建团队**：创建新团队（团队名称、团队代码、团队电话、团队地点、护士长信息等）

- **修改团队名称**：修改已创建团队的名称

- **删除团队**：删除团队（需检查是否有关联数据，如有则提示不可删除）

- **查看团队概览**：查看所有团队的数量、状态等概要信息（不涉及具体业务数据）

- **指定团队创建者**：为团队指定创建者（从已有用户中选择，或创建新用户并设置为团队创建者）

**说明**：系统管理员只能管理团队本身，不涉及团队内的具体业务数据（患者、医生、病种等）。团队创建者负责管理本团队并分配团队管理员。

---

# 👨‍⚕️ 医护端（medical_staff）

**数据隔离说明**：医护人员登录后，系统根据其 `team_id` 自动过滤数据，只能查看和操作本团队（科室）的患者、医生、病种、检查、房间等数据，确保不同团队数据相互独立。

### **1. 住院申请管理**

- 查看患者自助登记列表（待审核状态）

- 审核患者登记信息，可修改和补充

- 或直接录入新患者信息并发起住院申请

- 选择负责医生并提交排队

- 设置患者优先级（普通/高优先级/紧急）

- 通知患者进入排队状态

### **2. 住院证 OCR 识别**

- 上传照片 → 自动识别患者信息

- 识别失败时提供降级处理：重新拍照、手动录入、部分修正

- 可编辑和修正识别结果

- 录入/更新患者档案

### **3. 排队管理**

- 查看每个医生名下排队患者

- 查看等待人数

- 查看剩余床位

- 设置患者优先级（普通/高优先级/紧急）

- 调整排队顺序（按优先级自动排序）

### **4. 床位管理**

- 更新某医生今日出院人数

- 系统自动计算：剩余床位 = 总床位 - 已使用床位 + 今日出院

### **5. 检查提醒管理**

- 根据患者病种选择预设的检查项目（勾选即可，无需手动填写）

- 推送"请预约检查"给患者

- 查看患者填写的检查时间

- 查看哪些检查提醒已发送/未发送

### **6. 入院准备流程**

- 系统提醒哪些患者明天要入院

- 医护人员选择预设房间类型和入院时间

- 从模板库选择或编辑注意事项

- 推送给患者确认

- 查看患者是否确认

### **7. 入院操作**

- 查看哪些患者已确认

- 手动点击"确认入院"

- 系统自动扣减床位

---

# 👤 患者端（patient）

**多团队支持说明**：患者可以在多个团队（科室）进行登记和排队，患者端可切换查看不同团队的排队状态、检查提醒、入院信息等。

### **1. 自助登记**

- 填写基本信息（姓名/性别/年龄/电话/诊断描述）

- 选择团队或病种

- 提交登记信息

- 查看登记状态（待审核/已确认/已拒绝）

### **2. 排队流程**

- 查看当前团队的排队进度（可切换查看不同团队）

- 查看负责医生信息

- 接收排队状态通知

- 查看在不同团队的排队记录（如有多个团队）

### **2. 检查预约**

- 接收医护提醒

- 填写预约时间

- 到时间自动提醒

### **3. 入院前提醒**

- 接收入院通知

- 查看房间情况、注意事项

- 能否确认是否入院

### **4. 入院后信息**

- 查看有哪些注意事项（管理员模板）

- 查看团队电话、医生电话、团队地址

---

# 🛠 团队管理员端（team_admin）

**说明**：团队管理员由团队创建者分配，负责管理本团队的所有业务数据。

### **1. 团队医护账号管理**

- **生成团队邀请二维码**：创建团队后，系统自动生成团队邀请二维码（包含 `team_id` + `invite_signature`），可随时重新生成

- **查看申请加入列表**：查看医护人员提交的加入申请，显示申请人姓名、手机号、申请时间

- **审核加入申请**：同意或拒绝医护人员的加入申请
  - **同意**：系统自动创建账号，角色设为 `medical_staff`，关联到本团队，并通知申请人
  - **拒绝**：拒绝申请，并通知申请人

- **查看团队成员**：查看本团队所有医护人员列表

- **移除团队成员**：移除本团队的医护人员（需谨慎操作）

### **2. 团队医生配置**

- 创建本团队医生信息（但无登录）

- 设置所属团队（本团队内）

- 设置总床位

- 配置医生专长标签（用于智能匹配患者）

### **3. 团队信息管理**

- **创建团队**：创建新团队（团队名称、团队代码、团队电话、团队地点、护士长信息等）

- **编辑团队**：修改团队信息（团队名称、团队电话、团队地点、护士长信息、团队描述）

- **删除团队**：删除团队（需检查是否有关联数据，如有则提示不可删除）

- **查看团队列表**：查看所有团队及其基本信息

- **数据隔离说明**：不同团队的数据相互独立，包括患者、医生、病种、检查、房间等，确保团队间数据不混淆

**说明**：团队和科室是同一个概念，每个团队代表一个独立的科室。

### **4. 团队病种管理**

- 创建和维护本团队病种信息

- 设置病种对应的检查类目

- 配置病种的标准诊断描述

### **5. 团队检查类目管理**

- 创建和维护本团队检查项目

- 设置检查项目的标准名称和描述

- 关联检查项目到相应病种

### **6. 团队房间类型管理**

- 配置本团队标准房间类型（单人间、双人间、三人间、VIP房等）

- 设置不同房间类型的价格和描述

- 关联房间类型到团队

### **7. 团队入院时间配置**

- 配置本团队标准入院时间段（上午8:00、下午14:00等）

- 设置不同时间段的优先级和可用性

### **8. 团队注意事项模板管理**

- 创建本团队注意事项模板

- 按病种、团队、入院类型分类模板

- 支持富文本编辑和变量替换

### **9. 数据统计**

- 本团队排队人数统计

- 本团队每日入院人数统计

- 本团队床位占用率统计

---

# 🧱 四、数据模型（合并后再次优化）

## team（团队/科室）

**说明**：团队和科室是同一个概念，每个团队代表一个独立的科室，数据相互隔离。

```
id
name
code
description
phone
location
head_nurse_name
head_nurse_phone
invite_signature
creator_id
status
is_active
created_at
updated_at
created_by
```

**说明**：
- `invite_signature` 用于生成团队邀请二维码，确保邀请链接的安全性。创建团队时自动生成，可随时重新生成。
- `creator_id` 表示团队创建者的用户ID，团队创建者可以分配团队管理员。
- `created_by` 表示创建该团队的系统管理员ID。

## user_account（用户）

```
id
open_id
phone
name
role: super_admin | patient | medical_staff | team_admin
team_id
```

**说明**：`team_id` 表示用户所属的团队（科室），医护人员登录后只能操作本团队的数据。

## doctor（医生作为业务节点）

```
id
name
team_id
total_bed
available_bed
specialties
```

**说明**：医生属于某个团队（科室），`team_id` 用于数据隔离。

## patient_registration（患者自助登记）

```
id
user_id
team_id
name
sex
age
phone
disease_category_id
diagnosis_notes
status: pending | approved | rejected
submitted_at
reviewed_by
reviewed_at
review_notes
```

**说明**：患者登记时选择团队（科室），`team_id` 用于数据隔离。

## patient_info（患者信息）

```
id
user_id
team_id
name
sex
age
disease_category_id
doctor_id
phone
native_place_region_id
diagnosis_notes
created_at
updated_at
```

**患者多团队说明**：
- 一个患者（同一个 `user_id`）可以在不同团队（科室）有多个 `patient_info` 记录
- 每个团队的患者信息独立管理，互不影响
- 患者在不同团队的排队记录（`hospital_queue`）相互独立
- 患者端查看时，可切换查看不同团队的排队状态和信息
- 当前活跃团队以患者最新的 `hospital_queue` 记录中的 `team_id` 为准

## hospital_queue（排队）

```
id
patient_id
team_id
doctor_id
status: waiting | upcoming | pre_admission | confirmed | inpatient
plan_in_date
priority: normal | high | urgent
priority_reason
created_at
```

**说明**：`team_id` 用于数据隔离和统计。患者在不同团队（科室）的排队记录相互独立。

## pre_admission（预入院）

```
id
patient_id
team_id
room_type_id
admission_time_slot_id
notice_template_id
tips
patient_confirm_status
```

## check_appointment（检查预约）

```
id
patient_id
check_item_id
appointment_time
notify_sent
```

## disease_category（病种）

```
id
name
description
team_id
created_by
```

**说明**：病种属于某个团队（科室），不同团队的病种列表独立。

## check_item（检查类目）

```
id
name
description
team_id
disease_category_id
standard_duration
is_active
```

## disease_check_relation（病种-检查关联）

```
id
team_id
disease_category_id
check_item_id
is_required
sort_order
```

## room_type（房间类型）

```
id
name
description
price
team_id
is_active
capacity
```

**说明**：房间类型属于某个团队（科室），不同团队的房间类型独立配置。

## admission_time_slot（入院时间段）

```
id
time_slot
display_name
priority
is_active
team_id
```

**说明**：入院时间段属于某个团队（科室），不同团队可配置不同的时间段。

## notice_template（注意事项模板）

```
id
title
content
template_type
team_id
disease_category_id
is_active
created_by
```

**说明**：注意事项模板属于某个团队（科室），可按病种分类。

## region（地区信息）

```
id
name
parent_id
level
code
```

## team_join_request（团队加入申请）

```
id
team_id
applicant_name
applicant_phone
applicant_open_id
status: pending | approved | rejected
applied_at
reviewed_by
reviewed_at
review_notes
```

**说明**：医护人员扫码申请加入团队时创建此记录，管理员审核后更新状态。审核通过后，系统自动创建 `user_account` 记录。

---

# 🕒 五、定时任务（统一整理）

## 1. 每 5 分钟

- 检查检查预约、发送提醒

- 检查床位释放情况，按优先级自动分配床位给排队患者

## 2. 每天凌晨（02:00）

查找明天入院患者，提醒医护人员填写入院信息。

---

# 📱 六、平台架构与访问权限

## 平台支持

### 小程序端（患者 + 医护人员）
- **患者端**：支持小程序和网页端访问（网页端直接使用小程序界面）
- **医护端**：支持小程序和网页端访问（网页端直接使用小程序界面）

### 网页端（管理员专用）
- **团队管理员端**：仅支持网页端访问
- **系统管理员端**：仅支持网页端访问

## 页面结构

```
/pages/login

/pages/patient/... （患者端 - 小程序 + 网页） 

/pages/staff/...   （医护端 - 小程序 + 网页）

/pages/admin/...   （团队管理员端 - 仅网页）

/pages/super-admin/... （系统管理员端 - 仅网页）
```

## 访问控制

用户登录 → 后台返回 role → 根据角色和访问平台决定跳转页面：

- **患者（patient）**：可通过小程序或网页访问患者端功能
- **医护人员（medical_staff）**：可通过小程序或网页访问医护端功能
- **团队管理员（team_admin）**：仅可通过网页访问管理功能
- **系统管理员（super_admin）**：仅可通过网页访问系统管理功能

**说明**：网页端使用小程序界面，无需单独开发网页UI。管理员角色因功能复杂度和操作便利性，限制为仅网页端访问。

---

# 🧭 七、总结（最新版、最简、最清晰）

你最终需要开发的系统可总结为：

### ✔ 多平台支持

- **小程序 + 网页**：患者端和医护端（网页端使用小程序界面）
- **仅网页**：团队管理员端和系统管理员端

### ✔ 四个角色（系统管理员 / 患者 / 医护 / 团队管理员）

- **患者 + 医护**：可使用小程序或网页访问
- **团队管理员 + 系统管理员**：仅可使用网页访问

### ✔ 医生不再登录，只作为业务节点

### ✔ 医护人员承担医生和护士所有操作

### ✔ 自动化流程包含患者自助登记、医护审核确认、排队管理、检查提醒、入院前提醒、入院确认

### ✔ 支持 OCR 自动识别住院证（含识别失败降级处理）

### ✔ 系统自动管理床位

### ✔ 系统自动提醒患者和医护人员

---